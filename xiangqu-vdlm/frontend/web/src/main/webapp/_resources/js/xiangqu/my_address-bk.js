!function(){var t=location.host.indexOf("dev.www.xiangqutest.com")>-1?!0:!1;t=!1;var e={city:t?"/resources/js/testData/addressList/city.json":"/zone/children",saveAddress:t?"":"/address/save",myAddressList:t?"/resources/js/testData/addressList/list.json":"/address/list",delAddress:t?"":"/address/delete",defaultAddress:t?"/resources/js/testData/addressList/defaultAddress.json":"/address/asDefault",updateAddress:t?"":"/address/update"},s={init:function(){var t=this;t.J_wapOrder=$(".J_wapOrder"),t.J_myAddressLists=$(".J_myAddressLists"),t.J_noAddress=t.J_myAddressLists.find(".J_noAddress"),t.J_haveAddress=t.J_myAddressLists.find(".J_haveAddress"),t.J_tc=$(".J_tc"),t.addressList=[],t.isfirst=!0,t.eventHanding()},eventHanding:function(){var t=this;t.getAddressListData(),t.J_noAddress.on("click",function(e){e.preventDefault(),e.stopPropagation(),$("body").css("overflow","hidden"),t.J_tc.show(),t.J_tc.find(".J_tcAddressManage").show()}),t.J_haveAddress.on("click",function(e){return e.preventDefault(),e.stopPropagation(),0==t.J_tc.attr("data-isempty")?(t.J_tc.show(),$("body").css("overflow","hidden"),!1):void t.renderAddress()}),t.J_tc.find(".J_tcMyAddress").on("click",".J_closeAddressTc",function(e){e.preventDefault(),e.stopPropagation(),t.J_tc.removeAttr("style"),$("body").removeAttr("style")}),t.J_tc.find(".J_tcMyAddress").on("click",".J_tcAddressBtn",function(e){e.preventDefault(),e.stopPropagation(),t.J_tc.find(".J_tcAddressManage").show()}),t.J_tc.find(".J_tcAddressManage").on("click",".J_closeAddressTc",function(e){e.preventDefault(),e.stopPropagation(),$(this).closest(".J_tcAddressManage").removeAttr("style"),t.clearFrom()}),t.J_tc.find(".J_tcAddressManage").on("click",".J_tcAddressBtn",function(s){s.preventDefault(),s.stopPropagation();var d=$(this).closest(".J_tcAddressManage"),i=d.attr("data-addressid"),a=i?!1:!0,n={url:function(){return a?e.saveAddress:e.updateAddress}(),data:{addressId:function(){return a?"":i}(),consignee:t.trim(d.find(".J_newName").val()),phone:t.trim(d.find(".J_newPhone").val()),zoneId:function(){var t=d.find(".J_ciytsCheck");return 0!=t.find(".J_district").val()?t.find(".J_district").val():0!=t.find(".J_city").val()?t.find(".J_city").val():t.find(".J_province").val()}(),street:t.trim(d.find(".J_newStreet").val()),zipcode:t.trim(d.find(".J_newZipCode").val()),isDefault:function(){return d.find(".J_setDefault .check-default").hasClass("active")?!0:!1}(),t:function(){var t=new Date;return t.getTime()}()}};if(n.data){if(!n.data.consignee)return alert("姓名不能为空!"),!1;if(n.data.consignee.length>30)return alert("姓名最长30个字!"),!1;if(!n.data.phone)return alert("请填写手机号码!"),!1;if(!t.checkPhone(n.data.phone,!1))return alert("手机号码不正确！"),!1;if(n.data.zipcode&&t.reZipCode(n.data.zipcode))return alert("邮政编码格式不正确！"),!1;if(0==d.find(".J_province").val())return alert("省份不能为空！"),!1;if(d.find(".J_city option").length>1&&0==d.find(".J_city").val())return alert("市不能为空！"),!1;if(d.find(".J_district option").length>1&&0==d.find(".J_district").val())return alert("地区不能为空！"),!1;if(!n.data.street)return alert("详细地址不能为空！"),!1;if(!n.data.street>100)return alert("详细地址最长100个字！"),!1}t.sendAddressData(n,function(e){return 200!=e.code?(alert(e.msg),!1):(t.clearFrom(),t.J_tc.find(".J_tcAddressManage").removeAttr("style"),void t.updateMyAddressList(function(){if(t.renderAddress(),!a){var e=t.J_haveAddress.find("input").val(),s=t.J_tc.find(".J_tcMyAddress .J_addressInfo.active");if(s){var d=s.closest("li").find(".J_addRessShop").attr("data-addressid");if(e!=d)return!1;t.setCurrentAddress(s)}}}))})}),t.J_tc.find(".J_tcMyAddress").on("click",".J_editAddress",function(e){e.preventDefault(),e.stopPropagation();var s=this;t.editAddress(s)}),t.J_tc.on("click",".J_addressInfo",function(e){e.preventDefault(),e.stopPropagation();var s=this,d=$(this).hasClass("active");return d?!1:($(this).closest("li").siblings().find(".J_addressInfo").removeClass("active"),$(this).addClass("active"),t.setCurrentAddress(s),void(t.J_noAddress.attr("style")&&(t.J_noAddress.removeAttr("style"),t.J_haveAddress.show())))}),t.J_tc.on("click",".J_setDefaultAddress",function(e){e.preventDefault(),e.stopPropagation();var s=this,d=$(this).closest(".J_addRessShop").attr("data-addressid"),i=$(this).hasClass("active");return i?!1:void(d&&t.isfirst&&(t.isfirst=!1,t.setDefautAddress(d,function(e){return t.isfirst=!0,200!=e.code?(alert(e.msg),!1):($(s).closest("li").siblings("li").find(".J_aaressInfo").removeClass("active"),$(s).closest("li").siblings("li").find(".J_setDefaultAddress").removeClass("active").html("设置默认地址"),$(s).closest(".J_addressInfo").addClass("active"),void $(s).closest("li").find(".J_setDefaultAddress").addClass("active").html("默认地址"))})))}),t.J_tc.on("click",".J_delAddress",function(e){e.preventDefault(),e.stopPropagation();var s=$(this).closest(".J_addRessShop").attr("data-addressid");$(this).closest(".J_addressInfo").hasClass("active");t.J_tc.find(".J_tips").attr("data-addressid",s).show()}),t.J_tc.on("click",".J_cancel",function(e){e.preventDefault(),e.stopPropagation();t.J_tc.find(".J_tips").removeAttr("style"),t.J_tc.find(".J_tips").removeAttr("data-addressid")}),t.J_tc.on("click",".J_sure",function(e){e.preventDefault(),e.stopPropagation();var s=$(this).closest(".J_tips").attr("data-addressid");s&&t.isfirst&&(t.isfirst=!1,t.delAddressList(s,function(e){if(t.isfirst=!0,"string"==typeof e&&(e=$.parseJSON(e)),200!=e.code)return alert(e.msg),!1;t.J_tc.find(".J_tcMyAddress").find('.J_addRessShop[data-addressid*="'+s+'"]').closest("li").remove();var d=t.J_haveAddress.find("input").val();s==d&&t.J_haveAddress.find(".J_currentAddress").empty().html('<span class="tips">请选择收货地址</span>'),t.J_tc.find(".J_tips").removeAttr("style"),t.J_tc.find(".J_tips").removeAttr("data-addressid")}))}),t.J_tc.find(".J_tcAddressManage").on("click",".J_setDefault .check-default",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).hasClass("active");e?$(this).removeClass("active"):$(this).addClass("active")})},editAddress:function(t){var e=this,s=$(t).closest("li"),i=s.find(".J_name").attr("data-name")||"",a=s.find(".J_street .st").html()||"",n=s.find(".J_addRessShop").attr("data-zipcode")||"",r=s.find(".J_phone").attr("data-phone")||"",c=s.find(".J_setDefaultAddress").hasClass("active")?!0:!1,o=s.find(".J_addRessShop").attr("data-addressid")||"",f=s.find(".J_street .pcd").eq(0).attr("data-id")||"",l=s.find(".J_street .pcd").eq(1).attr("data-id")||"",J=s.find(".J_street .pcd").eq(2).attr("data-id")||"",_=e.J_tc.find(".J_tcAddressManage");_.attr("data-addressid",o),_.find(".J_newName").val(i),_.find(".J_newPhone").val(r),_.find(".J_newZipCode").val(n),_.find(".J_newStreet").val(a),c?_.find(".J_setDefault .check-default").addClass("active"):_.find(".J_setDefault .check-default").removeClass("active"),f&&(2==f||20==f||2465==f||861==f?_.find(".J_district").closest("div").hide():_.find(".J_district").closest("div").show(),_.find('.J_province option[value="'+f+'"]').attr("selected",!0),d.addressData({id:f},function(t){if(200==t.code){var e=d.initOption(t.data);_.find(".J_city").append(e),_.find('.J_city option[value="'+l+'"]').attr("selected",!0),J&&d.addressData({id:l},function(t){if(200==t.code){var e=d.initOption(t.data);_.find(".J_district").append(e),_.find('.J_district option[value="'+J+'"]').attr("selected",!0)}}),_.find(".J_tcContTitle .title").html("编辑地址"),_.show()}}))},clearFrom:function(){var t=this,e=t.J_tc.find(".J_tcAddressManage");e.removeAttr("data-addressid"),e.find(".J_tcContTitle .title").html("添加新地址"),e.find(".J_newName").val(""),e.find(".J_newPhone").val(""),e.find(".J_newZipCode").val(""),e.find(".J_province").val(0),e.find(".J_city option").not('[value="0"]').remove(),e.find(".J_district option").not('[value="0"]').remove(),e.find(".J_newStreet").val(""),e.find(".J_setDefault .check-default").removeClass("active")},sendAddressData:function(t,e){t=t||{};var s=t.data;$.ajax({url:t.url,type:"post",data:s,dataType:"json",success:function(t){e&&e(t)}})},delAddressList:function(t,s){$.ajax({url:e.delAddress,type:"get",data:{addressId:t,t:function(){var t=new Date;return t.getTime()}()},success:function(t){s&&s(t)}})},setDefautAddress:function(t,s){$.ajax({url:e.defaultAddress,type:"get",data:{addressId:t,t:function(){var t=new Date;return t.getTime()}()},dataType:"json",success:function(t){s&&s(t)}})},setCurrentAddress:function(t){var e=this,s=$(t).closest(".J_myAddressItem"),d=s.find(".J_addRessShop").attr("data-addressid"),i=(s.find(".J_addRessShop").attr("data-zipcode"),s.find(".J_name").attr("data-name")),a=s.find(".J_phone").attr("data-phone"),n=e.trim(s.find(".street-info").text()),r={address:n,name:i,phone:a,addressId:d},c=template("J_tempCurrentAddress",r);e.J_haveAddress.find(".J_currentAddress").empty().append(c)},renderAddress:function(){var t=this,e=t.addressList;if(e.length){var s={_data:e},d=template("J_tempAddressList",s);t.J_tc.find(".J_tcMyAddress").find(".J_tcContBody ul").empty().append(d);var i=t.J_haveAddress.find("input").val();t.J_tc.find(".J_tcMyAddress").find(".J_addressInfo").removeClass("active"),t.J_tc.find(".J_tcMyAddress").find('.J_addRessShop[data-addressid*="'+i+'"]').closest("li").find(".J_addressInfo").addClass("active"),$("body").css("overflow","hidden"),t.J_tc.attr("data-isempty","0").show()}},updateMyAddressList:function(t){var s=this;$.ajax({url:e.myAddressList,type:"get",data:{t:function(){var t=new Date;return t.getTime()}()},dataType:"json",success:function(e){if(200!=e.code)return alert(e.msg),!1;if(e.data.length){e.data.sort(function(t,e){return e.createdAt-t.createdAt}),s.addressList.length=0;for(var d=0,i=e.data.length;i>d;d++)e.data[d].isDefault?s.addressList.unshift(e.data[d]):s.addressList.push(e.data[d]);t&&t()}}})},getAddressListData:function(){var t=this;$.ajax({url:e.myAddressList,type:"get",data:{t:function(){var t=new Date;return t.getTime()}()},dataType:"json",success:function(e){if(200!=e.code)return alert(e.msg),!1;if(e.data.length){var s=[];e.data.sort(function(t,e){return e.createdAt-t.createdAt}),t.addressList.length=0;for(var d=0,i=e.data.length;i>d;d++)e.data[d].isDefault?t.addressList.unshift(e.data[d]):t.addressList.push(e.data[d]);if(s=t.addressList,s.length){var a=s[0].details.replace("中国",""),n=s[0].consignee,r=s[0].phone,c=s[0].id,o={address:a,name:n,phone:r,addressId:c},f=template("J_tempCurrentAddress",o);t.J_haveAddress.find(".J_currentAddress").empty().append(f),t.J_haveAddress.show()}}else t.J_noAddress.show()}})},checkPhone:function(t,e){var s;return s=e?/^((\+?86)|(\(\+86\)))?1\d{10}|(\([0-9]+\))?[0-9]{7,8}$/g:/^((\+?86)|(\(\+86\)))?1\d{10}$/g,s.test(t)?!0:!1},reZipCode:function(t){var e=/^[1-9][0-9]{5}$/g;return t?e.test(t)?!1:!0:void 0},trim:function(t){return t.replace(/(^\s*)|(\s*$)/g,"")}},d={init:function(){var t=this;t.J_citysCheck=$(".J_ciytsCheck"),t.eventHanding()},eventHanding:function(){var t=this;t.addressData({id:1},function(e){if(200==e.code){var s=t.initOption(e.data);t.J_citysCheck.find(".J_province").append(s)}}),t.J_citysCheck.find(".J_province").on("change",function(e){var s=$(this).val();return 2==s||20==s||2465==s||861==s?(t.J_citysCheck.find(".J_district").closest("div").hide(),t.J_citysCheck.find(".J_city").closest("div").show()):3513==s||3514==s||3515==s?(t.J_citysCheck.find(".J_city").closest("div").hide(),t.J_citysCheck.find(".J_district").closest("div").hide()):(t.J_citysCheck.find(".J_city").closest("div").show(),t.J_citysCheck.find(".J_district").closest("div").show()),0==s?(t.J_citysCheck.find(".J_city option").not('[value="0"]').remove(),t.J_citysCheck.find(".J_district option").not('[value="0"]').remove(),!1):void t.addressData({id:s},function(e){if(200==e.code){if(!e.data.length)return!1;var s=t.initOption(e.data);t.J_citysCheck.find(".J_city option").not('[value="0"]').remove(),t.J_citysCheck.find(".J_district option").not('[value="0"]').remove(),t.J_citysCheck.find('.J_city option[value="0"]').attr("selected",!0),t.J_citysCheck.find(".J_city").append(s)}})}),t.J_citysCheck.find(".J_city").on("change",function(){var e=$(this).val();return 0==e?(t.J_citysCheck.find(".J_district option").not('[value="0"]').remove(),!1):void t.addressData({id:e},function(e){if(200==e.code){if(!e.data.length)return!1;var s=t.initOption(e.data);t.J_citysCheck.find(".J_district option").not('[value="0"]').remove(),t.J_citysCheck.find('.J_district option[value="0"]').attr("selected",!0),t.J_citysCheck.find(".J_district").append(s)}})})},addressData:function(t,s){t=t||{},$.ajax({url:e.city,type:"get",data:{id:t.id,t:function(){var t=new Date;return t.getTime()}()},dataType:"json",success:function(t){s&&s(t)}})},initOption:function(t){var e="";if(t.length){for(var s=0,d=t.length;d>s;s++)e+='<option value="'+t[s].id+'">'+t[s].name+"</option>";return e}}};$(function(){s.init(),d.init()})}();