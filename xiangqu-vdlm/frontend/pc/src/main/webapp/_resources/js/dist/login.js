var KD=KD||{};KD.login={init:function(){$("input").placeholder(),$(".checkbox").iCheck(),this.renderCode(),this.callLogin(),this.loginEvent(),this.commonEvent(),this.callCode(),this.callCopyright(),this.callReg(),this.regEvent(),this.callForget(),this.forgetEvent(),this.callAlert(),this.initForm()},initForm:function(){$(".username").val($.cookie("username"))},save:function(a){$.cookie("username",a,{expires:7})},verifyPhone:function(a){var b=/^1\d{10}$/;return b.test(a)},verifyCaptcha:function(a){var b=/^\d{6}$/;return b.test(a)},verifyPassword:function(a){var b=/^.{6,50}$/;return b.test(a)},trimSpace:function(a){return a.replace(/\s/g,"")},verifyReg:function(a,b){var c=this,d=$(".reg-part"),e=$(".forget-part"),f=$(".common-part .send"),g=window.host+"/registered",h={mobile:a};c.postMethod(g,h,function(a){if("object"==typeof a)switch(a.errorCode){case 200:a.data?d.is(":visible")?(c.alertMethod("手机号码已被注册使用！"),f.removeClass("btn-enabled").addClass("btn-disabled")):"boolean"==typeof b&&b?c.sendEvent():f.removeClass("btn-disabled").addClass("btn-enabled"):e.is(":visible")?(c.alertMethod("手机号码未被注册使用！"),f.removeClass("btn-enabled").addClass("btn-disabled")):"boolean"==typeof b&&b?c.sendEvent():f.removeClass("btn-disabled").addClass("btn-enabled");break;default:"boolean"==typeof b&&b&&f.removeClass("btn-disabled").addClass("btn-enabled"),c.alertMethod(a.moreInfo)}})},verifyForm:function(a,b,c,d,e){var f,g,h,i;return f=b.val(),g=c.val(),h=d.val(),i=e.val(),f.length<1?(a.alertMethod("手机号码不能为空。"),!1):a.verifyPhone(b.val())?g.length<1?(a.alertMethod("验证码不能为空。"),!1):a.verifyCaptcha(c.val())?h.length<1?(a.alertMethod("密码不能为空。"),!1):a.verifyPassword(h)?i.length<1?(a.alertMethod("重复密码不能为空。"),!1):h!==i?(a.alertMethod("两次输入的密码不同。"),!1):!0:(a.alertMethod("请输入至少6位的密码。"),!1):(a.alertMethod("验证码格式不对。"),!1):(a.alertMethod("手机号码格式不对。"),!1)},postMethod:function(a,b,c){var d=this;$.ajax({url:a,data:b,type:"POST",dataType:"JSON",success:function(a){c(a)},error:function(){d.alertMethod("服务器暂时没有响应，请稍后重试。"),c(-1)},complete:function(){c(0)}})},loginEvent:function(){var a=this,b=$(".login"),c=$(".username"),d=$(".login-part .password"),e=!1;d.on("keyup",function(a){var c=a||event;return 13===c.keyCode?(b.trigger("click"),!1):void 0}),b.on("click",function(){var b,f;if(b=c.val(),f=d.val(),b.length<1)return a.alertMethod("手机号码不能为空。"),!1;if(!a.verifyPhone(b))return a.alertMethod("手机号码格式不正确。"),!1;if(f.length<1)return a.alertMethod("密码不能为空。"),!1;if(!a.verifyPassword(f))return a.alertMethod("请输入至少6位的密码。"),!1;if(e)return!1;e=!0;var g=window.host+"/signin_check",h={u:b,p:CryptoJS.MD5(f).toString()};return a.postMethod(g,h,function(c){if("object"==typeof c)switch(c.errorCode){case 200:a.save(b),location.href="/sellerpc/products/myproduct";break;default:a.alertMethod("登录失败，手机号码或密码错误!")}e=!1}),!1})},commonEvent:function(){var a=this,b=$(".username"),c=$(".common-part .captcha"),d=$(".common-part .send"),e=$(".common-part .new-password"),f=$(".common-part .re-password"),g=$(".reg-part"),h=$(".forget-part");b.add(c).numeric({decimal:!1,negative:!1,decimalPlaces:-1}),b.on("keyup",function(){var b=$(".username"),c=$(".common-part .send");return b.length>0&&a.verifyPhone(b.val())?c.removeClass("btn-disabled").addClass("btn-enabled"):c.removeClass("btn-enabled").addClass("btn-disabled"),!1}),b.on("blur",function(){var c=b.val(),e=$(".login-part");return c.length<1||e.is(":visible")?!1:(a.verifyPhone(c)?a.verifyReg(c):(d.removeClass("btn-enabled").addClass("btn-disabled"),a.alertMethod("手机号码格式不正确，请重新输入。")),!1)}),c.on("blur",function(){var d=c.val(),e=b.val();if(d.length<1)return!1;if(a.verifyCaptcha(d)&&a.verifyPhone(e)){var f=window.host,i={mobile:e,smsCode:d};if(g.is(":visible"))f+="/register/verify";else{if(!h.is(":visible"))return!1;f+="/pwdModify/verify"}a.postMethod(f,i,function(b){if("object"==typeof b)switch(b.errorCode){case 200:break;case-1:a.alertMethod("验证码不正确！");break;default:a.alertMethod(b.moreInfo)}})}else a.alertMethod("验证码格式不正确！")}),$("body").on("click",".send.btn-enabled",function(){var c=b.val();return d.removeClass("btn-count-state").removeClass("btn-enabled").addClass("btn-disabled"),c.length<1?(a.alertMethod("手机号码不能为空。"),!1):(a.verifyPhone(c)?a.verifyReg(c,!0):a.alertMethod("手机号码格式不正确，请重新输入。"),!1)}),e.add(f).on("keydown",function(a){var b=a||event;return 32===b.keyCode?!1:void 0}).on("paste",function(){return!1})},sendEvent:function(){function a(){0===g?(c.length>0&&b.verifyPhone(c.val())?d.removeClass("btn-count-state").addClass("btn-enabled").text("发送验证码"):d.removeClass("btn-count-state").addClass("btn-disabled").text("发送验证码"),g=60):(d.text("剩余"+g+"s..."),g--,setTimeout(function(){a()},1e3))}var b=this,c=$(".username"),d=$(".common-part .send"),e=$(".reg-part"),f=$(".forget-part"),g=60;d.removeClass("btn-enabled").removeClass("btn-disabled").addClass("btn-count-state"),a();var h=c.val(),i=window.host,j={mobile:h};if(e.is(":visible"))i+="/send-sms-code";else{if(!f.is(":visible"))return!1;i+="/forget-pwd"}b.postMethod(i,j,function(a){if("object"==typeof a)switch(a.errorCode){case 200:break;default:b.alertMethod(a.moreInfo)}})},regEvent:function(){var a=this,b=$(".reg"),c=$(".reg-part .checkbox"),d=$(".username"),e=$(".common-part .captcha"),f=$(".common-part .new-password"),g=$(".common-part .re-password"),h=!1;b.on("click",function(){var b,i,j,k;if(b=d.val(),i=e.val(),j=a.trimSpace(f.val()),k=a.trimSpace(g.val()),!a.verifyForm(a,d,e,f,g))return!1;if(!c.is(":checked"))return a.alertMethod("请同意《快快开店服务协议》。"),!1;if(h)return!1;h=!0;var l=window.host+"/register/create",m={mobile:b,smsCode:i,pwd:CryptoJS.MD5(j).toString()};return a.postMethod(l,m,function(b){if("object"==typeof b)switch(b.errorCode){case 200:a.alertMethod("注册成功！"),$(".common-part").hide(),$(".reg-part").hide(),$(".forget-part").hide(),$(".login-part").fadeIn();break;case-1:a.alertMethod(b.moreInfo);break;default:a.alertMethod(b.moreInfo)}h=!1}),!1})},forgetEvent:function(){var a=this,b=$(".modify"),c=$(".username"),d=$(".common-part .captcha"),e=$(".common-part .new-password"),f=$(".common-part .re-password"),g=!1;b.on("click",function(){var b,h,i,j;if(b=c.val(),h=d.val(),i=a.trimSpace(e.val()),j=a.trimSpace(f.val()),!a.verifyForm(a,c,d,e,f))return!1;if(g)return!1;g=!0;var k=window.host+"/validate-forget-pwd",l={mobile:b,smsCode:h,pwd:CryptoJS.MD5(i).toString()};return a.postMethod(k,l,function(b){if("object"==typeof b)switch(b.errorCode){case 200:a.alertMethod("修改密码成功！"),$(".common-part").hide(),$(".reg-part").hide(),$(".forget-part").hide(),$(".login-part").fadeIn();break;case-1:a.alertMethod(b.moreInfo);break;default:a.alertMethod(b.moreInfo)}g=!1}),!1})},callCode:function(){var a=$(".qr-code"),b=$(".code-box");a.on("mouseenter",function(){b.show()}).on("mouseleave",function(){b.fadeOut()})},alertMethod:function(a){var b=$(".model-dimmer"),c=$(".model-alert"),d=$(".model-alert .model-title"),e=$(".model-alert .model-body"),f=$(".model-alert .model-button");d.text("提示"),e.text(a),f.text("确定"),b.show(),c.fadeIn()},callAlert:function(){var a=$(".model-dimmer"),b=$(".model-alert"),c=$(".model-alert .model-button");b.on("click",function(a){a.stopPropagation()}),a.add(c).on("click",function(){return a.fadeOut(),b.fadeOut(),!1})},callCopyright:function(){var a=$(".kkkd-copyright"),b=$(".copyright-box");a.on("click",function(){return b.is(":visible")?b.fadeOut():b.fadeIn(),!1}),b.on("click",function(a){a.stopPropagation()}),$(document).on("click",function(){b.fadeOut()})},callReg:function(){var a=this;$(".login-part .tip-doing").on("click",function(){var b=$(".username"),c=$(".common-part .send");return b.length>0&&a.verifyPhone(b.val())?c.hasClass("btn-count-state")||c.removeClass("btn-disabled").addClass("btn-enabled"):c.hasClass("btn-count-state")||c.removeClass("btn-enabled").addClass("btn-disabled"),$(".common-part .captcha").val(""),$(".common-part .new-password[type=password]").val(""),$(".common-part .re-password[type=password]").val(""),$(".reg-part .checkbox").iCheck("check"),$(".login-part").hide(),$(".forget-part").hide(),$(".common-part").fadeIn(),$(".reg-part").fadeIn(),!1})},callLogin:function(){$(".reg-part .tip-doing, .forget-part .tip-doing").on("click",function(){return $(".login-part .password[type=password]").val(""),$(".common-part").hide(),$(".reg-part").hide(),$(".forget-part").hide(),$(".login-part").fadeIn(),!1})},callForget:function(){var a=this;$(".forget").on("click",function(){var b=$(".username"),c=$(".common-part .send");return b.length>0&&a.verifyPhone(b.val())?c.hasClass("btn-count-state")||c.removeClass("btn-disabled").addClass("btn-enabled"):c.hasClass("btn-count-state")||c.removeClass("btn-enabled").addClass("btn-disabled"),$(".common-part .captcha").val(""),$(".common-part .new-password[type=password]").val(""),$(".common-part .re-password[type=password]").val(""),$(".reg-part").hide(),$(".login-part").hide(),$(".common-part").fadeIn(),$(".forget-part").fadeIn(),!1})},renderCode:function(){var a="";try{document.createElement("canvas").getContext("2d"),a="canvas"}catch(b){a="table"}var c="https://itunes.apple.com/us/app/kuai-kuai-kai-dian/id905157044",d="http://kkkd.com/d/kkkd-release.apk";$(".code-box .ios dt").qrcode({render:a,text:c,width:104,height:104}),$(".code-box .android dt").qrcode({render:a,text:d,width:104,height:104})}},$(function(){KD.login.init()});